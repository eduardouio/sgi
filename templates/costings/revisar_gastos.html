{% extends "base/base.html" %}
{% load static %}
{% block header %}
<script src="{% static "js/vue.js" %}"></script>
<script src="{% static "js/vue-router.js" %}"></script>
{% endblock header %}
{% block title_content %}
<div class="row border">
  <div class="col-6">
    <i class="fa fa-cog"></i>
    Contabilizar Gastos Iniciales Pedido {{ order.order.nro_pedido }}
    {% if order.bg_isclosed  == 0 %}
    <span class="badge badge-success">Abierto</span>
    {% else %}
    <span class="badge badge-dark">Liquidado y Cerrado</span>
    {% endif %}
  </div>
  <div class="col-6 text-right">
    Refrendo: <strong>{{ order.order.nro_refrendo }}</strong>
    |
    Liquidación Aduana: <strong>{{ order.order.nro_liquidacion }}</strong>
  </div>
</div>
{% endblock title_content %}
{% block content %}
<div id="app">
<div class="row" id="loading" v-if="ajaxRequest">
<div class="col-4"></div>
<div class="col-4">
   <img src="https://upload.wikimedia.org/wikipedia/commons/b/b1/Loading_icon.gif" alt="">
</div>
<div class="col-4"></div>
</div>
<div v-if="ajaxRequest == false">
  <div class="row">
    <div class="col-12">
      <table class="table table-bordered table-condensed">
        <tbody>
          <tr>
            <td style="width:100px;" class="text-right bg-light">Pedido:</td>
            <td>{{ order.order.nro_pedido }}</td>
            <td style="width:100px;" class="text-right bg-light">Proveedor:</td>
            <td>{{ order.order_invoice.supplier }} ID:{{ order.order_invoice.supplier.identificacion_proveedor }} </td>
            <td style="width:100px;" class="text-right bg-light">Factura:</td>
            <td>
              {{ order.order_invoice.order_invoice.id_factura_proveedor }}
            </td>
            <td style="width:100px;" class="text-right bg-light">Moneda:</td>
            <td>{{ order.order_invoice.order_invoice.moneda }}</td>
            <td style="width:100px;" class="text-right bg-light">T/C:</td>
            <td>{{ order.order_invoice.order_invoice.tipo_cambio }}</td>
          </tr>
          <tr>
            <td style="width:100px;" class="text-right bg-light">Incoterm:</td>
            <td>{{ order.order.incoterm }}</td>
            <td style="width:100px;" class="text-right bg-light">Pais Origen:</td>
            <td>{{ order.order.pais_origen }}</td>
            <td style="width:100px;" class="text-right bg-light">Ciudad Origen:</td>
            <td>{{ order.order.ciudad_origen }}</td>
            <td style="width:100px;" class="text-right bg-light">Registrado Por:</td>
            <td>Pendiete</td>
            <td style="width:100px;" class="text-right bg-light">Fecha Registro:</td>
            <td>{{ order.order.date_create | date:"d/M/Y" }}</td>
          </tr>
          <tr>
            <td style="width:100px;" class="text-right bg-light">Comentarios:</td>
            <td colspan="9">{{ order.order.observaciones }} {{ order.order.comentarios }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  <div class="row">
    <div class="col-7 div-bordered">
      <div class="text-tittle"> RESUMEN DE ESTADO GASTOS USD</div>
      <table class="table table-condensed table-striped table-bordered">
        <tbody>
          <tr style="background-color: #fff;">
            <th class="text-center"><i class="fas fas-list"></i></th>
            <th class="text-center">CONCEPTO</th>
            <th class="text-center">VALOR</th>
            <th class="text-center">FACTURADO</th>
            <th class="text-center">SALDO</th>
            <th class="text-center">MAYOR</th>
          </tr>
          <tr @click="select_expense('invoice')">
            <td class="text-center text-primary"><i class="fas fa-chevron-right"></i></td>
            <td>
            <small class="text-success" v-if="order_data.order_invoice.complete"><i class="fas fa-check-circle"></i></small>
            <small class="text-danger" v-if="order_data.order_invoice.provision"><i class="fas fa-exclamation-triangle"></i></small>
               FACTURA ${ order_data.order_invoice.supplier.nombre }
            </td>
            <td class="text-right"> ${ order_data.order_invoice.order_invoice.valor | money }</td>
            <td class="text-right"> ${ order_data.order_invoice.order_invoice.valor | money }</td>
            <td class="text-right"> ${ 0 | money }</td>
            <td class="text-right"> ${ order_data.order_invoice.order_invoice.valor | money }</td>
          </tr>
          <tr @click="select_expense('')" v-if="order_data.order.regimen === '10'">
            <td class="text-center text-primary"><i class="fas fa-chevron-right"></i></td>
            <td>
            <small class="text-success" v-if="order_data.taxes.complete"><i class="fas fa-check-circle"></i></small>
            <small class="text-danger" v-else=""><i class="fas fa-exclamation-triangle"></i></small>
            TRIBUTOS SENAE
            </td>
            <td class="text-right">${ order_data.taxes.total_provisionado | money  }</td>
            <td class="text-right">${ order_data.taxes.total_pagado | money  }</td>
            <td class="text-right">${ (order_data.taxes.total_provisionado - order_data.taxes.total_pagado ) | money  }</td>
            <td class="text-right">${ order_data.taxes.total_pagado | money  }</td>
          </tr>
          <tr v-for="item in order_data.expenses" @click="select_expense(item)">
            <td class="text-center text-primary"><i class="fas fa-chevron-right"></i></td>
            <td>
              <small class="text-secondary" v-if="item.parcial"><i class="fas fa-puzzle-piece"></i></small>
              <small class="text-success" v-if="item.complete"><i class="fas fa-check-circle"></i></small>
              <small class="text-danger" v-if="item.provision"><i class="fas fa-exclamation-triangle"></i></small>
              ${ item.expense.concepto }
            </td>
            <td class="text-right">${ item.expense.valor_provisionado | money }</td>
            <td class="text-right">${ item.invoiced_value | money }</td>
            <td class="text-right">${ item.sale | money }</td>
            <td class="text-right">${ item.legder | money }</td>
          </tr>
          <tr>
            <th colspan="2">Sumas</th>
            <th>0</th>
            <th>0</th>
            <th>0</th>
            <th>0</th>
          </tr>
        </tbody>
      </table>
      <br />
      <span class="text-right">Fecha de LLegada Del Producto:
      <strong class="text-success">{{ order.fecha_llegada_cliente }}</strong>
      </span>
      <br />
      <br>
      <a href="{{ BASE_URL }}">
      <button> <span class="fa fa-file-pdf"></span> Reporte Gastos </button>
      </a>
      <a href="{{ BASE_URL }}">
      <button><span class="fa fa-arrow-left"></span> Ficha Pedido</button>
      </a>
      <a href="{{ BASE_URL }}">
      <button>
      <span class="fa fa-money-bill-alt"></span> Tributos Iniciales
      </button>
      </a>
      <a href="{{ BASE_URL }}">
      <button>
      <span class="fa fa-list"></span> Lista Parciales
      </button>
      </a>
      <a href="{{ BASE_URL }}">
      <button>
      <span class="fa fa-money-bill"></span> Reliquidación
      </button>
      </a>
      <br />
      <br />
    </div>
    <div class="col-5 div-bordered" v-if="current_expense.expense">
      <div class="text-tittle"> DESCRIPCIÓN DE GASTO </div>
      <br> 
      <div class="row">
        <div class="col-7">
          <h6 class="text-dark">${ current_expense.expense.concepto } </h6>
        </div>
        <div class="col-5 text-right">
          <small class="text-secondary" v-if="current_expense.parcial"><i class="fas fa-puzzle-piece"></i> Justificación Parcial</small>
          <small class="text-success" v-if="current_expense.complete"><i class="fas fa-check-circle"></i> Justificado</small>
          <small class="text-danger" v-if="current_expense.provision"><i class="fas fa-exclamation-triangle"></i> Provisión</small>

        </div>
      </div>
      <div class="row">
        <div class="col-12">
          <table class="table table-condensed table-bordered">
            <thead>
              <tr>
                <th>Ver</th>
                <th>Proveedor</th>
                <th>Nro Factura</th>
                <th>Fecha</th>
                <th>Valor</th>
                <th>En Mayor</th>
              </tr>
            </thead>
            <tbody>
              <tr v-for="paid in current_expense.paids">
                <td class="text-center text-primary"><i class="fa fa-eye"></i></td>
                <td>${ paid.supplier.nombre }</td>
                <td class="text-right">${ paid.invoice.nro_factura }</td>
                <td class="text-right">${ paid.invoice.fecha_emision }</td>
                <td class="text-right">${ paid.paid.valor | money }</td>
                <td class="text-right" @click="contabilized(paid)">
                  <div class="custom-control custom-checkbox">
                    <input type="checkbox" class="custom-control-input" v-model="paid.paid.bg_mayor">
                    <label class="custom-control-label">
                    <span v-if="paid.paid.bg_mayor" class="text-success">
                    SI
                    </span>
                    <span v-else="" class="text-danger">
                    NO
                    </span>
                    </label>
                  </div>
                </td>
              </tr>
              <tr>
                <th colspan="4">Sumas</th>
                <th>00</th>
                <th>--</th>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <br>
      <div class="row">
        <div class="col-4 text-center">
          <h6>$ ${ current_expense.expense.valor_provisionado | money }</h6>
          <span class="text-secondary">Monto Gasto</span>
        </div>
        <div class="col-4 text-center">
          <h6>$ ${ current_expense.invoiced_value | money }</h6>
          <span class="text-success">Justificado</span>
        </div>
        <div class="col-4 text-center">
          <h6>$ ${ (current_expense.expense.valor_provisionado - current_expense.invoiced_value) | money }</h6>
          <span class="text-danger">Provisión</span>
        </div>
      </div>
      <hr>
      <div class="row">
        <div class="col-4">
          <div class="fomr-group"><label for="">Saldo Mayor Sap</label>
            <input type="text" class="form-control form-control-sm text-right" v-model="mayor_sap">
          </div>
        </div>
        <div class="col-4">
          <div class="fomr-group"><label for="">Saldo Mayor SGI</label>
            <input type="text" class="form-control form-control-sm text-right" readonly v-model="mayor_sgi" step="0.001">
          </div>
        </div>
        <div class="col-4">
          <div class="fomr-group"><label for="">Diferencias</label>
            <input type="text" class="form-control form-control-sm text-right" readonly v-model="diff_ledgers">
          </div>
        </div>
      </div>
    </div>
    <div class="col-5 div-bordered text-center" v-else>
      <br>
      <br>
      <br>
      <h5 class="text-secondary"> Seleccione un gasto </h5>
      <h1><span class="far fa-smile text-secondary"></span></h1>
    </div>
  </div>
</div>
</div>
{% endblock content %}
{% block script %}
   {% include "js/app_costings.js" %}
{% endblock script %}