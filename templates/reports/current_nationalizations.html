{% extends 'base/base.html' %}
{% block header %}
<!--CARGAMOS LIBRERIAS ADICIONALES PARA MOSTRAR LA TABLA-->
<link rel="stylesheet" href="{{ static('css/jquery.dataTables.min.css') }}">
<script src="{{ static('js/jquery.dataTables.min.js') }}"></script>
{% endblock %}
{% block title_content %}
    <div class="row border">
   <div class="col-8">
      <i class="fa fa-list"></i>
      Reporte de productos en Nacionalización {% if data.data %}  {{ data.data.__len__() }} {% endif %}
   </div>
   <div class="col-4 text-right">SGI <small>[Sistema Gestón de Importaciones] Reportes</small></div>
</div>
{% endblock title_content %}
{% block content %}
<div class="container-fluid">
    <br>
    <div class="row">
        <div class="col-4">
            <form class="form-inline" method="get">
                <div class="form-check mb-2 mr-sm-2">
                    <input class="form-check-input" type="checkbox" id="inlineFormCheck" name="deep" {% if request.GET.deep  == 'on'%} checked {%endif%} >
                    <label class="form-check-label" for="inlineFormCheck">
                        <strong>
                            Mostrar producto con costeo realizado
                        </strong> 
                    </label>
                </div>
                <button type="submit" class="btn btn-outline-primary btn-sm"> <i class="fas fa-sync"></i> Actualizar Reporte</button>
            </form>
        </div>
        {% if request.GET.deep == 'on' %}
        <div class="col-4 text-center text-info"> <h6>REPORTE DE PRODUCTOS EN PROCESO DE NACIONALIZACION <span class="text-primary">[HISTORICO]</span></h6></div>
        {% else %}
        <div class="col-4 text-center text-info"> <h6>REPORTE DE PRODUCTOS EN PROCESO DE NACIONALIZACION</h6></div>
        {% endif %}
        <div class="col-4 text-right"></div>
    </div>
    <div class="row">
        <div class="col-12">
        <div class="table-responsive">
            <table class="table table-condensed table-bordered table-hover" id="ReproteActivos">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Pedido</th>
                        <th>Proveedor</th>
                        <th>Reg</th>
                        <th>Producto</th>
                        <th>ML</th>
                        <th>Cajas</th>
                        <th>Unds</th>
                        <th>Nro DAI</th>
                        <th>Fecha Liq</th>
                        <th>Etiquetas</th>
                        <th>Pegado</th>
                        <th>Aforo</th>
                        <th>Salida Aut</th>
                        <th>Llegada</th>
                        <th>Días</th>
                        <th>Sts</th>
                    </tr>
                </thead>
                <tbody>
                {%for item in data.report%} 
                <tr>
                    <td>
                    <a href="#">
                        <i class="fas fa-pen-square"></i> {{ loop.index }}
                    </a>
                    </td>
                    <td nowrap="">
                        {% if item.origen != 'CONSUMO' %}
                            <a class="text-dark" target="_blank" href="{{ request.enterprise.url_app_importaciones}}index.php/gstnacionalizacion/parcial/{{item.id_parcial}}"> {{item.nro_pedido }} <small class="text-info">[{{item.id_parcial}}]</small></a>
                        {% else %}
                            <a class="text-dark" target="_blank" href="{{ request.enterprise.url_app_importaciones}}index.php/pedido/presentar/{{item.nro_pedido}}"> {{item.nro_pedido }}</a>

                        {% endif %}
                    </td>
                    <td nowrap="">{{item.nombre }}</td>
                    <td class="text-center">
                        {% if item.origen  %}
                            {{item.origen}}
                        {% else %}
                            --
                        {% endif %}
                    </td>
                    <td nowrap="">{{item.product }}</td>
                    <td class="text-center">{{item.capacidad_ml | round(0) }}</td>
                    <td class="text-right">{{item.nro_cajas | round(0) }} X {{ item.cantidad_x_caja | round(0) }}</td>
                    <td class="text-right">{{item.unidades | round(0) }}</td>
                    <td nowrap="" class="text-center">{{item.nro_refrendo}}</td>
                    <td nowrap="" class="text-center">{% if item.fecha_liquidacion %}{{ item.fecha_liquidacion.strftime('%d/%m/%Y')}} {%else%} <i class="fas fa-ban"></i> {% endif %}</td>
                    <td nowrap="" class="text-center">{% if item.fecha_entrega_etiquetas_senae %}{{ item.fecha_entrega_etiquetas_senae.strftime('%d/%m/%Y')}} {%else%}<i class="fas fa-minus text-danger"></i>{% endif %}</td>
                    <td nowrap="" class="text-center">{% if item.fecha_pegado_etiquetas %}{{ item.fecha_pegado_etiquetas.strftime('%d/%m/%Y')}} {%else%}<i class="fas fa-minus text-danger"></i>{% endif %}</td>
                    <td nowrap="" class="text-center">{% if item.fecha_aforo %}{{ item.fecha_aforo.strftime('%d/%m/%Y')}} {%else%}<i class="fas fa-minus text-danger"></i>{% endif %}</td>
                    <td nowrap="" class="text-center">{% if item.fecha_salida_autorizada %}{{ item.fecha_salida_autorizada.strftime('%d/%m/%Y')}} {%else%}<i class="fas fa-minus text-danger"></i>{% endif %}</td>
                    <td nowrap="" class="text-center">{% if item.fecha_llegada_cliente %}{{ item.fecha_llegada_cliente.strftime('%d/%m/%Y')}} {%else%}<i class="fas fa-minus text-danger"></i>{% endif %}</td>
                    <td class="text-center">
                    {% if item.bg_isclosed %}
                        {% if item.fecha_llegada_cliente %}
                            {{ ( item.fecha_llegada_cliente - item.fecha_liquidacion ).days  }}
                        {% else %}
                            <i class="fas fa-calendar-times"></i>
                        {% endif %}
                    {% else %}
                        {{ (data.today - item.fecha_liquidacion).days }}
                    {% endif %}
                    </td>
                    <td class="text-center">{% if item.bg_isclosed %}<i class="fas fa-check text-success"></i>{% else %}<i class="fas fa-lock-open text-info"></i>{% endif %}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
        </div>
    </div>
</div>
{% block footer %}
<script>
    $(document).ready( function () {
    $('#ReproteActivos').dataTable();
} );
</script>
{% endblock %}
{% endblock content %}